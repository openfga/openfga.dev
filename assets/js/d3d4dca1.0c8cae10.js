"use strict";(self.webpackChunkopenfga_dev=self.webpackChunkopenfga_dev||[]).push([[5362],{99052:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>c,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var n=i(87462),o=(i(67294),i(3905)),a=i(5270);const r={sidebar_position:5,slug:"/modeling/roles-and-permissions"},s="Roles and Permissions",l={unversionedId:"content/modeling/roles-and-permissions",id:"content/modeling/roles-and-permissions",title:"Roles and Permissions",description:"In this guide you will learn how to model roles and permissions model within  using the  and .",source:"@site/docs/content/modeling/roles-and-permissions.mdx",sourceDirName:"content/modeling",slug:"/modeling/roles-and-permissions",permalink:"/docs/modeling/roles-and-permissions",draft:!1,editUrl:"https://github.com/openfga/openfga.dev/edit/main/docs/content/modeling/roles-and-permissions.mdx",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5,slug:"/modeling/roles-and-permissions"},sidebar:"docs",previous:{title:"User Groups",permalink:"/docs/modeling/user-groups"},next:{title:"Parent-Child Objects",permalink:"/docs/modeling/parent-child"}},p={},d=[{value:"Before you start",id:"before-you-start",level:2},{value:"Direct Access",id:"direct-access",level:3},{value:"<ProductName format={ProductNameFormat.ShortForm}/> Concepts",id:"-concepts",level:3},{value:"Step By Step",id:"step-by-step",level:2},{value:"01. Understand How Roles Work Within Our Trip Booking System",id:"01-understand-how-roles-work-within-our-trip-booking-system",level:3},{value:"02. Adding Permissions For Bookings",id:"02-adding-permissions-for-bookings",level:3},{value:"03. Checking User Roles And Their Permissions",id:"03-checking-user-roles-and-their-permissions",level:3},{value:"Related Sections",id:"related-sections",level:2}],m={toc:d};function c(e){let{components:t,...i}=e;return(0,o.kt)("wrapper",(0,n.Z)({},m,i,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"roles-and-permissions"},"Roles and Permissions"),(0,o.kt)(a.AH,{mdxType:"DocumentationNotice"}),(0,o.kt)("p",null,"In this guide you will learn how to model roles and permissions model within ",(0,o.kt)(a.rZ,{format:a.v7.ProductLink,mdxType:"ProductName"})," using the ",(0,o.kt)("em",{parentName:"p"},(0,o.kt)(a.uH,{section:"what-is-an-authorization-model",linkName:"authorization model",mdxType:"ProductConcept"}))," and ",(0,o.kt)("em",{parentName:"p"},(0,o.kt)(a.uH,{section:"what-is-a-relationship-tuple",linkName:"relationship tuple",mdxType:"ProductConcept"})),"."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Roles")," are assigned to ",(0,o.kt)(a.uH,{section:"what-is-a-user",linkName:"users",mdxType:"ProductConcept"})," or a group of users, where any user can have more than one role (",(0,o.kt)("inlineCode",{parentName:"li"},"editor"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"owner"),", etc..)."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Permissions")," are what allows users to access certain ",(0,o.kt)(a.uH,{section:"what-is-an-object",linkName:"objects",mdxType:"ProductConcept"})," based on their specific roles (",(0,o.kt)("inlineCode",{parentName:"li"},"device_renamer"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"channel_archiver"),", etc..).")),(0,o.kt)("p",null,"For example, the role ",(0,o.kt)("inlineCode",{parentName:"p"},"viewer")," of a ",(0,o.kt)("inlineCode",{parentName:"p"},"trip")," can have ",(0,o.kt)("strong",{parentName:"p"},"permissions to view bookings")," or the role ",(0,o.kt)("inlineCode",{parentName:"p"},"owners")," can have ",(0,o.kt)("strong",{parentName:"p"},"permissions to add/view bookings to a trip.")),(0,o.kt)(a.S1,{title:"When to use",appearance:"filled",description:(0,o.kt)("div",null,(0,o.kt)("p",null,"When trying to create a role and permissions model within ",(0,o.kt)(a.rZ,{format:a.v7.ShortForm,mdxType:"ProductName"}),".:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Create roles by creating relations that can be directly assigned to users"),(0,o.kt)("li",{parentName:"ul"},"Assign permissions by creating relations that users get through other relations")),(0,o.kt)("p",null,"For example:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Grant someone an ",(0,o.kt)("inlineCode",{parentName:"li"},"admin")," role that can ",(0,o.kt)("inlineCode",{parentName:"li"},"edit")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"read")," a ",(0,o.kt)("inlineCode",{parentName:"li"},"document")),(0,o.kt)("li",{parentName:"ul"},"Grant someone a ",(0,o.kt)("inlineCode",{parentName:"li"},"security_guard")," role that can ",(0,o.kt)("inlineCode",{parentName:"li"},"live_video_viewer")," on a ",(0,o.kt)("inlineCode",{parentName:"li"},"device")),(0,o.kt)("li",{parentName:"ul"},"Grant someone a ",(0,o.kt)("inlineCode",{parentName:"li"},"viewer")," role that can ",(0,o.kt)("inlineCode",{parentName:"li"},"view_products")," on a ",(0,o.kt)("inlineCode",{parentName:"li"},"shop"))),(0,o.kt)("p",null,"There are advantages to implementing roles and permissions within ",(0,o.kt)(a.rZ,{format:a.v7.ShortForm,mdxType:"ProductName"}),", such as:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Breaking down existing roles to have more fine grained permissions. This allows your application to check whether a ",(0,o.kt)("em",{parentName:"li"},"user")," has access to a certain object without having to explicitly check that specific ",(0,o.kt)("em",{parentName:"li"},"users")," role."),(0,o.kt)("li",{parentName:"ul"},"Introduce new roles/permissions or consolidate roles without affecting your application behavior. For example: if in your app all the checks are for the fine permissions ",(0,o.kt)("inlineCode",{parentName:"li"},"check('bob', 'booking_adder', 'trip:Europe')")," instead of ",(0,o.kt)("inlineCode",{parentName:"li"},"check('bob', 'owner', 'trip:Europe')"),", and then you later decide ",(0,o.kt)("inlineCode",{parentName:"li"},"owners")," can no longer add bookings to a ",(0,o.kt)("inlineCode",{parentName:"li"},"trip"),", you can remove the relation within the ",(0,o.kt)("inlineCode",{parentName:"li"},"trip")," type with no code changes in your application, and all the permissions will automatically honor the change."))),mdxType:"CardBox"}),(0,o.kt)("h2",{id:"before-you-start"},"Before you start"),(0,o.kt)("p",null,"In order to understand this guide correctly you must be familiar with some ",(0,o.kt)(a.uH,{mdxType:"ProductConcept"})," and know how to develop the things that we will list below."),(0,o.kt)("details",null,(0,o.kt)("summary",null,(0,o.kt)("p",null,"Assume that you have the following ",(0,o.kt)(a.uH,{section:"what-is-an-authorization-model",linkName:"authorization model",mdxType:"ProductConcept"}),".",(0,o.kt)("br",null),"\nYou have a ",(0,o.kt)(a.uH,{section:"what-is-a-type",linkName:"type",mdxType:"ProductConcept"})," called ",(0,o.kt)("inlineCode",{parentName:"p"},"trip")," that ",(0,o.kt)("em",{parentName:"p"},"users")," can be related to as ",(0,o.kt)("inlineCode",{parentName:"p"},"viewer")," and/or an ",(0,o.kt)("inlineCode",{parentName:"p"},"owner"),".")),(0,o.kt)(a.lG,{configuration:{type_definitions:[{type:"trip",relations:{owner:{this:{}},viewer:{this:{}}}}]},mdxType:"AuthzModelSnippetViewer"}),(0,o.kt)("hr",null),(0,o.kt)("p",null,"In addition, you will need to know the following:"),(0,o.kt)("h3",{id:"direct-access"},"Direct Access"),(0,o.kt)("p",null,"You need to know how to create an authorization model and create a relationship tuple to grant a user access to an object. ",(0,o.kt)("a",{parentName:"p",href:"/docs/modeling/direct-access"},"Learn more \u2192")),(0,o.kt)("h3",{id:"-concepts"},(0,o.kt)(a.rZ,{format:a.v7.ShortForm,mdxType:"ProductName"})," Concepts"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"A ",(0,o.kt)(a.uH,{section:"what-is-a-type",linkName:"Type",mdxType:"ProductConcept"}),": a class of objects that have similar characteristics"),(0,o.kt)("li",{parentName:"ul"},"A ",(0,o.kt)(a.uH,{section:"what-is-a-user",linkName:"User",mdxType:"ProductConcept"}),": an entity in the system that can be related to an object"),(0,o.kt)("li",{parentName:"ul"},"A ",(0,o.kt)(a.uH,{section:"what-is-a-relation",linkName:"Relation",mdxType:"ProductConcept"}),": is a string defined in the type definition of an authorization model that defines the possibility of a relationship between an object of the same type as the type definition and a user in the system"),(0,o.kt)("li",{parentName:"ul"},"An ",(0,o.kt)(a.uH,{section:"what-is-an-object",linkName:"Object",mdxType:"ProductConcept"}),": represents an entity in the system. Users' relationships to it can be define through relationship tuples and the authorization model"),(0,o.kt)("li",{parentName:"ul"},"A ",(0,o.kt)(a.uH,{section:"what-is-a-relationship-tuple",linkName:"Relationship Tuple",mdxType:"ProductConcept"}),": a grouping consisting of a user, a relation and an object stored in Auth ",(0,o.kt)(a.rZ,{format:a.v7.ShortForm,mdxType:"ProductName"})),(0,o.kt)("li",{parentName:"ul"},"A ",(0,o.kt)(a.uH,{section:"what-is-a-relationship",linkName:"Relationship",mdxType:"ProductConcept"}),": ",(0,o.kt)(a.rZ,{format:a.v7.ShortForm,mdxType:"ProductName"})," will be called to check if there is a relationship between a user and an object, indicating that the access is allowed"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/configuration-language#the-direct-relationship-keyword"},"Direct Relationship Keyword"),": The ",(0,o.kt)("inlineCode",{parentName:"li"},"self")," keyword can be used to indicate direct relationships between users and objects"),(0,o.kt)("li",{parentName:"ul"},"A ",(0,o.kt)(a.uH,{section:"what-is-a-check-request",linkName:"Check API Request",mdxType:"ProductConcept"})," the Check API Request is used to check for relationships between users and objects"))),(0,o.kt)(a.XQ,{mdxType:"Playground"}),(0,o.kt)("h2",{id:"step-by-step"},"Step By Step"),(0,o.kt)("p",null,"To illustrate modeling Roles and Permissions in ",(0,o.kt)(a.rZ,{format:a.v7.ShortForm,mdxType:"ProductName"}),", we will use a trip booking system where you can have ",(0,o.kt)("inlineCode",{parentName:"p"},"owners")," and/or ",(0,o.kt)("inlineCode",{parentName:"p"},"viewers")," that can have more granular permissions such as adding bookings to a trip or viewing bookings on it."),(0,o.kt)("p",null,"In order to represent this, we need to:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Understand how roles are related to direct relations for our trip booking system"),(0,o.kt)("li",{parentName:"ol"},"Adding implied relations to existing authorization model to define permissions for bookings"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)(a.uH,{section:"what-is-a-check-request",linkName:"Checking",mdxType:"ProductConcept"})," user roles and their permissions based on *relationship tuples* for direct and implied relations")),(0,o.kt)("h3",{id:"01-understand-how-roles-work-within-our-trip-booking-system"},"01. Understand How Roles Work Within Our Trip Booking System"),(0,o.kt)("p",null,"Relating roles within ",(0,o.kt)(a.rZ,{format:a.v7.ShortForm,mdxType:"ProductName"})," can be best described as the following: ",(0,o.kt)("strong",{parentName:"p"},"Roles are relations that can be directly assigned to users.")," Looking at our authorization model, our roles would then be ",(0,o.kt)("inlineCode",{parentName:"p"},"owner")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"viewer"),". Meaning that a specific ",(0,o.kt)("em",{parentName:"p"},"user")," can be an ",(0,o.kt)("inlineCode",{parentName:"p"},"owner")," and/or a ",(0,o.kt)("inlineCode",{parentName:"p"},"viewer"),"."),(0,o.kt)(a.lG,{configuration:{type_definitions:[{type:"trip",relations:{owner:{this:{}},viewer:{this:{}}}}]},mdxType:"AuthzModelSnippetViewer"}),(0,o.kt)("h3",{id:"02-adding-permissions-for-bookings"},"02. Adding Permissions For Bookings"),(0,o.kt)("p",null,"Permissions within ",(0,o.kt)(a.rZ,{format:a.v7.LongForm,mdxType:"ProductName"})," can be best described as the following: ",(0,o.kt)("strong",{parentName:"p"},"Permissions are relations that users get only through other relations.")," To represent permissions, we avoid adding the ",(0,o.kt)("a",{parentName:"p",href:"/docs/configuration-language#the-direct-relationship-keyword"},(0,o.kt)("strong",{parentName:"a"},"direct relationship keyword"))," (",(0,o.kt)("inlineCode",{parentName:"p"},"self"),") to the relation in the authorization model. Instead, we define the relation from other relations to indicate that it is a permission granted to and implied from a different relation."),(0,o.kt)("p",null,"To add permissions related to bookings, we can add new relations to the ",(0,o.kt)("inlineCode",{parentName:"p"},"trip")," ",(0,o.kt)("em",{parentName:"p"},"object")," type denoting the various actions a user can take on ",(0,o.kt)("inlineCode",{parentName:"p"},"trips")," (view, edit, delete, rename, etc...)"),(0,o.kt)("p",null,"To allow ",(0,o.kt)("inlineCode",{parentName:"p"},"viewers")," of a ",(0,o.kt)("inlineCode",{parentName:"p"},"trip")," to have ",(0,o.kt)("strong",{parentName:"p"},"permissions to view bookings")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"owners")," to have ",(0,o.kt)("strong",{parentName:"p"},"permissions to add/view bookings,")," we would modify the type as the following:"),(0,o.kt)(a.lG,{configuration:{type_definitions:[{type:"trip",relations:{owner:{this:{}},viewer:{this:{}},booking_adder:{computedUserset:{relation:"owner"}},booking_viewer:{union:{child:[{computedUserset:{relation:"viewer"}},{computedUserset:{relation:"owner"}}]}}}}]},mdxType:"AuthzModelSnippetViewer"}),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Note: notice how both ",(0,o.kt)("inlineCode",{parentName:"p"},"booking_viewer")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"booking_adder")," don't have the ",(0,o.kt)("inlineCode",{parentName:"p"},"self")," syntax, this is to ensure that the relation can only be assigned through the ",(0,o.kt)("strong",{parentName:"p"},"role")," and not directly.")),(0,o.kt)("h3",{id:"03-checking-user-roles-and-their-permissions"},"03. Checking User Roles And Their Permissions"),(0,o.kt)("p",null,"Now that our type definitions reflects the roles and permissions on how bookings can be viewed/added. Let's create ",(0,o.kt)("em",{parentName:"p"},(0,o.kt)(a.uH,{section:"what-is-a-relationship-tuple",linkName:"relationship tuples",mdxType:"ProductConcept"}))," to assign roles to ",(0,o.kt)("em",{parentName:"p"},"users")," and then ",(0,o.kt)("em",{parentName:"p"},(0,o.kt)(a.uH,{section:"what-is-a-check-request",linkName:"check",mdxType:"ProductConcept"})),"if ",(0,o.kt)("em",{parentName:"p"},"users")," have the proper permissions."),(0,o.kt)("p",null,"Let us create two relationship tuples:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"that gives ",(0,o.kt)("strong",{parentName:"li"},"bob")," the role of ",(0,o.kt)("inlineCode",{parentName:"li"},"viewer")," on ",(0,o.kt)("inlineCode",{parentName:"li"},"trip"),": ",(0,o.kt)("strong",{parentName:"li"},"Europe"),"."),(0,o.kt)("li",{parentName:"ol"},"that gives ",(0,o.kt)("strong",{parentName:"li"},"alice")," the role of ",(0,o.kt)("inlineCode",{parentName:"li"},"owner")," on ",(0,o.kt)("inlineCode",{parentName:"li"},"trip"),": ",(0,o.kt)("strong",{parentName:"li"},"Europe"),".")),(0,o.kt)(a.Gb,{relationshipTuples:[{_description:"Add bob as viewer on trip:Europe",user:"bob",relation:"viewer",object:"trip:Europe"},{_description:"Add alice as owner on trip:Europe",user:"alice",relation:"owner",object:"trip:Europe"}],mdxType:"WriteRequestViewer"}),(0,o.kt)("p",null,"Now we can check: ",(0,o.kt)("strong",{parentName:"p"},"is bob allowed to view bookings on trip Europe?")),(0,o.kt)(a.uT,{user:"bob",relation:"booking_viewer",object:"trip:Europe",allowed:!0,mdxType:"CheckRequestViewer"}),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"bob")," is a ",(0,o.kt)("inlineCode",{parentName:"p"},"booking_viewer")," because of the following chain of resolution:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"bob")," is a ",(0,o.kt)("inlineCode",{parentName:"li"},"viewer")," on ",(0,o.kt)("inlineCode",{parentName:"li"},"trip"),": ",(0,o.kt)("strong",{parentName:"li"},"Europe")),(0,o.kt)("li",{parentName:"ol"},"Any user related to the ",(0,o.kt)("em",{parentName:"li"},"object")," ",(0,o.kt)("inlineCode",{parentName:"li"},"trip:"),(0,o.kt)("strong",{parentName:"li"},"Europe")," as ",(0,o.kt)("inlineCode",{parentName:"li"},"viewer")," is also related as a ",(0,o.kt)("inlineCode",{parentName:"li"},"booking_viewer")," (i.e ",(0,o.kt)("inlineCode",{parentName:"li"},"usersRelatedToObjectAs: viewer"),")"),(0,o.kt)("li",{parentName:"ol"},"Therefore, all ",(0,o.kt)("inlineCode",{parentName:"li"},"viewers")," on a given ",(0,o.kt)("inlineCode",{parentName:"li"},"trip")," are ",(0,o.kt)("inlineCode",{parentName:"li"},"booking_viewers"))),(0,o.kt)("p",null,"To confirm that ",(0,o.kt)("strong",{parentName:"p"},"bob is not allowed to add bookings on trip Europe"),", we can do the following check:"),(0,o.kt)(a.uT,{user:"bob",relation:"booking_adder",object:"trip:Europe",allowed:!1,mdxType:"CheckRequestViewer"}),(0,o.kt)("p",null,"We can also check: ",(0,o.kt)("strong",{parentName:"p"},"is alice allowed to view and add bookings on trip Europe?")),(0,o.kt)(a.uT,{user:"alice",relation:"booking_viewer",object:"trip:Europe",allowed:!0,mdxType:"CheckRequestViewer"}),(0,o.kt)(a.uT,{user:"alice",relation:"booking_adder",object:"trip:Europe",allowed:!0,mdxType:"CheckRequestViewer"}),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"alice")," is a ",(0,o.kt)("inlineCode",{parentName:"p"},"booking_viewer")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"booking_adder")," because of the following chain of resolution:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"alice")," is a ",(0,o.kt)("inlineCode",{parentName:"li"},"owner")," on ",(0,o.kt)("inlineCode",{parentName:"li"},"trip"),": ",(0,o.kt)("strong",{parentName:"li"},"Europe")),(0,o.kt)("li",{parentName:"ol"},"Any user related to the ",(0,o.kt)("em",{parentName:"li"},"object")," ",(0,o.kt)("inlineCode",{parentName:"li"},"trip:"),(0,o.kt)("strong",{parentName:"li"},"Europe")," as ",(0,o.kt)("inlineCode",{parentName:"li"},"owner")," is also related as a ",(0,o.kt)("inlineCode",{parentName:"li"},"booking_viewer")),(0,o.kt)("li",{parentName:"ol"},"Any user related to the ",(0,o.kt)("em",{parentName:"li"},"object")," ",(0,o.kt)("inlineCode",{parentName:"li"},"trip:"),(0,o.kt)("strong",{parentName:"li"},"Europe")," as ",(0,o.kt)("inlineCode",{parentName:"li"},"owner")," is also related as a ",(0,o.kt)("inlineCode",{parentName:"li"},"booking_adder")),(0,o.kt)("li",{parentName:"ol"},"Therefore, all ",(0,o.kt)("inlineCode",{parentName:"li"},"owners")," on a given ",(0,o.kt)("inlineCode",{parentName:"li"},"trip")," are ",(0,o.kt)("inlineCode",{parentName:"li"},"booking_viewers")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"booking_adders")," on that trip")),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},(0,o.kt)("strong",{parentName:"p"},"Note:")," Make sure to use unique ids for each object and user within your application domain when creating relationship tuples for ",(0,o.kt)(a.rZ,{format:a.v7.LongForm,mdxType:"ProductName"}),". We are using first names and simple ids to just illustrate an easy-to-follow example.")),(0,o.kt)("h2",{id:"related-sections"},"Related Sections"),(0,o.kt)(a.$q,{description:"Check the following sections for more on how to model for roles and permissions.",relatedLinks:[{title:"Modeling Concepts: Concentric Relationships",description:"Learn about how to represent a concentric relationships in {ProductName}.",link:"./building-blocks/concentric-relationships",id:"./building-blocks/concentric-relationships"},{title:"Modeling Google Drive",description:"See how to indicate that editors are commenters and viewers in Google Drive.",link:"./advanced/gdrive#01-individual-permissions",id:"./advanced/gdrive.mdx#01-individual-permissions"},{title:"Modeling GitHub",description:"See how to indicate that repository admins are writers and readers in GitHub.",link:"./advanced/github#01-permissions-for-individuals-in-an-org",id:"./advanced/github.mdx#01-permissions-for-individuals-in-an-org"}],mdxType:"RelatedSection"}))}c.isMDXComponent=!0}}]);