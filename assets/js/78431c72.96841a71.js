"use strict";(self.webpackChunkopenfga_dev=self.webpackChunkopenfga_dev||[]).push([[4706],{37995:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>d,default:()=>u,frontMatter:()=>l,metadata:()=>o,toc:()=>p});var n=a(87462),i=(a(67294),a(3905)),r=a(5270);const l={title:"IoT",description:"Modeling Fine Grained Authorization for an IoT Security Camera System",sidebar_position:3,slug:"/modeling/advanced/iot"},d="Modeling Authorization for an IoT Security System with <ProductName format={ProductNameFormat.ShortForm}/>",o={unversionedId:"content/modeling/advanced/iot",id:"content/modeling/advanced/iot",title:"IoT",description:"Modeling Fine Grained Authorization for an IoT Security Camera System",source:"@site/docs/content/modeling/advanced/iot.mdx",sourceDirName:"content/modeling/advanced",slug:"/modeling/advanced/iot",permalink:"/docs/modeling/advanced/iot",draft:!1,editUrl:"https://github.com/openfga/openfga.dev/edit/main/docs/content/modeling/advanced/iot.mdx",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"IoT",description:"Modeling Fine Grained Authorization for an IoT Security Camera System",sidebar_position:3,slug:"/modeling/advanced/iot"},sidebar:"docs",previous:{title:"Slack",permalink:"/docs/modeling/advanced/slack"},next:{title:"Entitlements",permalink:"/docs/modeling/advanced/entitlements"}},s={},p=[{value:"Before You Start",id:"before-you-start",level:2},{value:"<ProductName format={ProductNameFormat.ShortForm}/> Concepts",id:"-concepts",level:3},{value:"Direct Access",id:"direct-access",level:4},{value:"Modeling Concentric Relationships",id:"modeling-concentric-relationships",level:4},{value:"Direct Relationships",id:"direct-relationships",level:4},{value:"User Groups",id:"user-groups",level:4},{value:"Concepts &amp; Configuration Language",id:"concepts--configuration-language",level:4},{value:"What You Will Be Modeling",id:"what-you-will-be-modeling",level:2},{value:"Requirements",id:"requirements",level:3},{value:"Defined Scenarios",id:"defined-scenarios",level:3},{value:"Modeling Device Authorization",id:"modeling-device-authorization",level:2},{value:"01. Writing The Initial Model For A Device",id:"01-writing-the-initial-model-for-a-device",level:3},{value:"02. Inserting Some Relationship Tuples",id:"02-inserting-some-relationship-tuples",level:3},{value:"Verification",id:"verification",level:4},{value:"03. Updating Our Authorization Model To Facilitate Future Changes",id:"03-updating-our-authorization-model-to-facilitate-future-changes",level:3},{value:"Verification",id:"verification-1",level:4},{value:"04. Modeling Device Groups",id:"04-modeling-device-groups",level:3},{value:"Updating Relationship Tuples On Roles",id:"updating-relationship-tuples-on-roles",level:4},{value:"Verification",id:"verification-2",level:4},{value:"05. Disallow Direct Relationships To Users",id:"05-disallow-direct-relationships-to-users",level:3},{value:"Updating The Authorization Model",id:"updating-the-authorization-model",level:4},{value:"Verification",id:"verification-3",level:4},{value:"Summary",id:"summary",level:2},{value:"Exercises For You",id:"exercises-for-you",level:3}],m={toc:p};function u(e){let{components:t,...l}=e;return(0,i.kt)("wrapper",(0,n.Z)({},m,l,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"modeling-authorization-for-an-iot-security-system-with-"},"Modeling Authorization for an IoT Security System with ",(0,i.kt)(r.rZ,{format:r.v7.ShortForm,mdxType:"ProductName"})),(0,i.kt)(r.AH,{mdxType:"DocumentationNotice"}),(0,i.kt)("p",null,"This tutorial explains how to model permissions for an IoT system using ",(0,i.kt)(r.rZ,{format:r.v7.ShortForm,mdxType:"ProductName"}),"."),(0,i.kt)(r.S1,{title:"What you will learn",mdxType:"CardBox"},(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"How to model a permission system using ",(0,i.kt)(r.rZ,{format:r.v7.ProductLink,mdxType:"ProductName"})),(0,i.kt)("li",{parentName:"ul"},"How to see ",(0,i.kt)(r.rZ,{format:r.v7.ShortForm,mdxType:"ProductName"})," Authorization in action by modeling an IoT Security Camera System"))),(0,i.kt)(r.XQ,{title:"IoT",preset:"iot",example:"IoT",store:"iot",mdxType:"Playground"}),(0,i.kt)("h2",{id:"before-you-start"},"Before You Start"),(0,i.kt)("p",null,"In order to understand this guide correctly you must be familiar with some ",(0,i.kt)(r.rZ,{format:r.v7.LongForm,mdxType:"ProductName"})," concepts and know how to develop the things that we will list below."),(0,i.kt)("details",null,(0,i.kt)("summary",null,(0,i.kt)("h3",{id:"-concepts"},(0,i.kt)(r.rZ,{format:r.v7.ShortForm,mdxType:"ProductName"})," Concepts"),(0,i.kt)("p",null,"It would be helpful to have an understanding of some concepts of ",(0,i.kt)(r.rZ,{format:r.v7.ShortForm,mdxType:"ProductName"})," before you start.")),(0,i.kt)("h4",{id:"direct-access"},"Direct Access"),(0,i.kt)("p",null,"You need to know how to create an authorization model and create a relationship tuple to grant a user access to an object. ",(0,i.kt)("a",{parentName:"p",href:"/docs/modeling/direct-access"},"Learn more \u2192")),(0,i.kt)("h4",{id:"modeling-concentric-relationships"},"Modeling Concentric Relationships"),(0,i.kt)("p",null,"You need to know how to update the authorization model to allow having nested relations such as all writers are readers. ",(0,i.kt)("a",{parentName:"p",href:"/docs/modeling/building-blocks/concentric-relationships"},"Learn more \u2192"),"\nUsed here to indicate that both IT Admins and Security Guards can view live video."),(0,i.kt)("h4",{id:"direct-relationships"},"Direct Relationships"),(0,i.kt)("p",null,"You need to know how to disallow granting direct relation to an object and requiring the user to have a relation with another object that would imply a relation with the first one. ",(0,i.kt)("a",{parentName:"p",href:"/docs/modeling/building-blocks/direct-relationships"},"Learn more \u2192"),'\nUsed here to indicate that "Rename Device" is a permission that cannot be assigned directly, but can only be granted through the "IT Admin" role.'),(0,i.kt)("h4",{id:"user-groups"},"User Groups"),(0,i.kt)("p",null,"You need to know how to add users to groups and create relationships between groups of users and an object. ",(0,i.kt)("a",{parentName:"p",href:"/docs/modeling/building-blocks/direct-relationships"},"Learn more \u2192")),(0,i.kt)("p",null,"Used here to indicate that security guards on a certain group are security guards on a device in that group."),(0,i.kt)("h4",{id:"concepts--configuration-language"},"Concepts & Configuration Language"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Some ",(0,i.kt)(r.uH,{mdxType:"ProductConcept"})),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/configuration-language"},"Configuration Language")))),(0,i.kt)("h2",{id:"what-you-will-be-modeling"},"What You Will Be Modeling"),(0,i.kt)("p",null,"In this tutorial, you will build an authorization model for a sample IoT Security Camera System (detailed below) using ",(0,i.kt)(r.rZ,{format:r.v7.LongForm,mdxType:"ProductName"}),". You will use some scenarios to validate the model."),(0,i.kt)("p",null,"The goal by the end of this post is to ask ",(0,i.kt)(r.rZ,{format:r.v7.ShortForm,mdxType:"ProductName"}),": Does person X have permission to perform action Y on device Z? In response, you want to either get a confirmation that person X can indeed do that, or a rejection that they cannot."),(0,i.kt)("h3",{id:"requirements"},"Requirements"),(0,i.kt)("p",null,"These are the requirements:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Security guards")," have access to ",(0,i.kt)("strong",{parentName:"li"},"view live and recorded video")," from ",(0,i.kt)("strong",{parentName:"li"},"Devices"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"IT Admins")," can ",(0,i.kt)("strong",{parentName:"li"},"view live and recorded videos"),", as well as ",(0,i.kt)("strong",{parentName:"li"},"rename")," ",(0,i.kt)("strong",{parentName:"li"},"Devices"),"."),(0,i.kt)("li",{parentName:"ul"},"To make access management easier, ",(0,i.kt)("strong",{parentName:"li"},"Devices")," can be grouped into ",(0,i.kt)("strong",{parentName:"li"},"Device Groups"),". ",(0,i.kt)("strong",{parentName:"li"},"Security guards")," with access to the ",(0,i.kt)("strong",{parentName:"li"},"Device Group")," are ",(0,i.kt)("strong",{parentName:"li"},"Security Guards")," with access to each ",(0,i.kt)("strong",{parentName:"li"},"Device")," in the group. Similarly for ",(0,i.kt)("strong",{parentName:"li"},"IT Admins"),".")),(0,i.kt)("h3",{id:"defined-scenarios"},"Defined Scenarios"),(0,i.kt)("p",null,"Use the following scenarios to be able to validate whether the model of the requirements is correct."),(0,i.kt)("p",null,"There will be the following users:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Anne"),(0,i.kt)("li",{parentName:"ul"},"Beth"),(0,i.kt)("li",{parentName:"ul"},"Charles"),(0,i.kt)("li",{parentName:"ul"},"Dianne")),(0,i.kt)("p",null,"These users have the following roles and permissions:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Anne is a Security Guard with access to only Device 1"),(0,i.kt)("li",{parentName:"ul"},"Beth is an IT Admin with access to only Device 1"),(0,i.kt)("li",{parentName:"ul"},"Charles is a Security Guard with access to Device 1 and everything in Device Group 1 (which is Device 2 and Device 3)"),(0,i.kt)("li",{parentName:"ul"},"Dianne is an IT Admin with access to Device 1 and everything in Device Group 1")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Image showing requirements",src:a(74943).Z,width:"1205",height:"461"})),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"In production, it is highly recommended to use unique, immutable identifiers. Names are used in this article to make it easier to read and follow.")),(0,i.kt)("h2",{id:"modeling-device-authorization"},"Modeling Device Authorization"),(0,i.kt)("p",null,"The ",(0,i.kt)(r.rZ,{format:r.v7.LongForm,mdxType:"ProductName"})," service is based on ",(0,i.kt)("a",{parentName:"p",href:"https://zanzibar.academy"},"Zanzibar"),", a Relationship Based Access Control system. This means it relies on ",(0,i.kt)(r.uH,{section:"what-is-an-object",linkName:"object",mdxType:"ProductConcept"})," and ",(0,i.kt)(r.uH,{section:"what-is-a-user",linkName:"user",mdxType:"ProductConcept"})," ",(0,i.kt)(r.uH,{section:"what-is-a-relation",linkName:"relations",mdxType:"ProductConcept"})," to perform authorization ",(0,i.kt)(r.uH,{section:"what-is-a-check-request",linkName:"checks",mdxType:"ProductConcept"}),"."),(0,i.kt)("p",null,"Starting with devices, you will learn how to express the requirements in terms of relations you can feed into ",(0,i.kt)(r.rZ,{format:r.v7.LongForm,mdxType:"ProductName"}),"."),(0,i.kt)("h3",{id:"01-writing-the-initial-model-for-a-device"},"01. Writing The Initial Model For A Device"),(0,i.kt)("p",null,"The requirements stated:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Security guards")," have access to ",(0,i.kt)("strong",{parentName:"li"},"view live and recorded video")," from ",(0,i.kt)("strong",{parentName:"li"},"Devices"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"IT Admins")," can ",(0,i.kt)("strong",{parentName:"li"},"view live and recorded videos"),", as well as ",(0,i.kt)("strong",{parentName:"li"},"rename")," ",(0,i.kt)("strong",{parentName:"li"},"Devices"),".")),(0,i.kt)("p",null,"The goal is to ask ",(0,i.kt)(r.rZ,{format:r.v7.ShortForm,mdxType:"ProductName"})," whether person X has permission to perform action Y on device Z. To start, you will set aside the Security Guard and IT Admin designations and focus on the actions a user can take."),(0,i.kt)("p",null,"The actions users can take on a device are: ",(0,i.kt)("em",{parentName:"p"},"view live videos"),", ",(0,i.kt)("em",{parentName:"p"},"view recorded videos"),", and ",(0,i.kt)("em",{parentName:"p"},"rename devices"),". Mapping them to relations, they become: ",(0,i.kt)("em",{parentName:"p"},"live_video_viewer"),", ",(0,i.kt)("em",{parentName:"p"},"recorded_video_viewer"),", ",(0,i.kt)("em",{parentName:"p"},"device_renamer"),"."),(0,i.kt)("p",null,"In ",(0,i.kt)(r.rZ,{format:r.v7.ShortForm,mdxType:"ProductName"}),", the ",(0,i.kt)(r.uH,{section:"what-is-an-authorization-model",linkName:"authorization model",mdxType:"ProductConcept"})," for the device would be:"),(0,i.kt)(r.lG,{configuration:{schema_version:"1.1",type_definitions:[{type:"user"},{type:"device",relations:{live_video_viewer:{this:{}},recorded_video_viewer:{this:{}},device_renamer:{this:{}}},metadata:{relations:{live_video_viewer:{directly_related_user_types:[{type:"user"}]},recorded_video_viewer:{directly_related_user_types:[{type:"user"}]},device_renamer:{directly_related_user_types:[{type:"user"}]}}}}]},mdxType:"AuthzModelSnippetViewer"}),(0,i.kt)("h3",{id:"02-inserting-some-relationship-tuples"},"02. Inserting Some Relationship Tuples"),(0,i.kt)("p",null,"The requirements are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Anne")," is a ",(0,i.kt)("strong",{parentName:"li"},"Security Guard")," with access to only ",(0,i.kt)("strong",{parentName:"li"},"Device 1")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Beth")," is an ",(0,i.kt)("strong",{parentName:"li"},"IT Admin")," with access to only ",(0,i.kt)("strong",{parentName:"li"},"Device 1")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Security Guards")," can ",(0,i.kt)("strong",{parentName:"li"},"view live and recorded video")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"IT Admins")," can ",(0,i.kt)("strong",{parentName:"li"},"view live and recorded video")," and ",(0,i.kt)("strong",{parentName:"li"},"rename")," devices")),(0,i.kt)("p",null,"Before we tackle the problem of users access to device based on their role, we will try to grant user access based on their view relationship directly."),(0,i.kt)("p",null,"We will first focus on Anne and Beth's relationship with Device 1."),(0,i.kt)("p",null,"To add Anne as live_video_viewer of device:1:"),(0,i.kt)(r.Gb,{relationshipTuples:[{user:"user:anne",relation:"live_video_viewer",object:"device:1"}],mdxType:"WriteRequestViewer"}),(0,i.kt)("p",null,"To add Anne as recorded_video_viewer of device:1"),(0,i.kt)(r.Gb,{relationshipTuples:[{user:"user:anne",relation:"recorded_video_viewer",object:"device:1"}],mdxType:"WriteRequestViewer"}),(0,i.kt)("p",null,"Likewise, we will add Beth's relationship with device:1."),(0,i.kt)(r.Gb,{relationshipTuples:[{user:"user:beth",relation:"live_video_viewer",object:"device:1"},{user:"user:beth",relation:"recorded_video_viewer",object:"device:1"},{user:"user:beth",relation:"device_renamer",object:"device:1"}],mdxType:"WriteRequestViewer"}),(0,i.kt)("h4",{id:"verification"},"Verification"),(0,i.kt)("p",null,"Now that you have some relationship tuples added, you can start using it to ",(0,i.kt)(r.uH,{section:"what-is-a-check-request",linkName:"ask",mdxType:"ProductConcept"})," some questions, e.g., whether a person has access to rename a device."),(0,i.kt)("p",null,"First, you will find out if ",(0,i.kt)("inlineCode",{parentName:"p"},"anne")," has permission to ",(0,i.kt)("inlineCode",{parentName:"p"},"view the live video")," on ",(0,i.kt)("inlineCode",{parentName:"p"},"device:1"),", then you will see if ",(0,i.kt)("inlineCode",{parentName:"p"},"anne")," can ",(0,i.kt)("inlineCode",{parentName:"p"},"rename")," ",(0,i.kt)("inlineCode",{parentName:"p"},"device:1"),"."),(0,i.kt)("p",null,"Anne has ",(0,i.kt)("inlineCode",{parentName:"p"},"live_video_viewer")," relationship with device:1."),(0,i.kt)(r.uT,{user:"user:anne",relation:"live_video_viewer",object:"device:1",allowed:!0,mdxType:"CheckRequestViewer"}),(0,i.kt)("p",null,"On the other hand, Anne does not have ",(0,i.kt)("inlineCode",{parentName:"p"},"device_renamer")," relationship with device:1."),(0,i.kt)(r.uT,{user:"user:anne",relation:"device_renamer",object:"device:1",allowed:!1,mdxType:"CheckRequestViewer"}),(0,i.kt)("p",null,"Now, check the other relationships fore Anne and Beth."),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"User"),(0,i.kt)("th",{parentName:"tr",align:null},"Object"),(0,i.kt)("th",{parentName:"tr",align:null},"Relation"),(0,i.kt)("th",{parentName:"tr",align:null},"Query"),(0,i.kt)("th",{parentName:"tr",align:null},"Relation?"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"anne")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:1")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"live_video_viewer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is anne related to device:1 as live_video_viewer?")),(0,i.kt)("td",{parentName:"tr",align:null},"Yes")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"beth")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:1")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"live_video_viewer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is beth related to device:1 as live_video_viewer?")),(0,i.kt)("td",{parentName:"tr",align:null},"Yes")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"anne")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:1")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"recorded_video_viewer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is anne related to device:1 as recorded_video_viewer?")),(0,i.kt)("td",{parentName:"tr",align:null},"Yes")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"beth")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:1")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"recorded_video_viewer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is beth related to device:1 as recorded_video_viewer?")),(0,i.kt)("td",{parentName:"tr",align:null},"Yes")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"anne")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:1")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device_renamer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is anne related to device:1 as device_renamer?")),(0,i.kt)("td",{parentName:"tr",align:null},"No")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"beth")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:1")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device_renamer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is beth related to device:1 as device_renamer?")),(0,i.kt)("td",{parentName:"tr",align:null},"Yes")))),(0,i.kt)("h3",{id:"03-updating-our-authorization-model-to-facilitate-future-changes"},"03. Updating Our Authorization Model To Facilitate Future Changes"),(0,i.kt)("p",null,"Notice how you had to add the Anne and Beth as ",(0,i.kt)(r.uH,{section:"what-are-direct-and-implied-relationships",linkName:"direct relations",mdxType:"ProductConcept"})," to all the actions they can take on Device 1 instead of just stating that they are related as Security Guard or IT Admin, and having the other permissions implied? In practice this might have some disadvantages: if your authorization model changes, (e.g so that Security Guards can no longer view previously recorded videos), you would need to change relationship tuples in the system instead of just changing the configuration."),(0,i.kt)("p",null,"We can address this by using ",(0,i.kt)("a",{parentName:"p",href:"/docs/modeling/building-blocks/concentric-relationships"},(0,i.kt)("strong",{parentName:"a"},"concentric relation models")),". It allows you to express that sets of users who have a relation X to the object also have relation Y. For example, anyone that is related to the device as a ",(0,i.kt)("inlineCode",{parentName:"p"},"security_guard")," is also related as a ",(0,i.kt)("inlineCode",{parentName:"p"},"live_video_viewer")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"recorded_video_viewer"),", and anyone who is related to the device as an ",(0,i.kt)("inlineCode",{parentName:"p"},"it_admin")," is also related as a ",(0,i.kt)("inlineCode",{parentName:"p"},"live_video_viewer"),", a ",(0,i.kt)("inlineCode",{parentName:"p"},"recorded_video_viewer"),", and a ",(0,i.kt)("inlineCode",{parentName:"p"},"device_renamer"),"."),(0,i.kt)("p",null,"At the end you want to make sure that ",(0,i.kt)(r.uH,{section:"what-is-a-check-request",linkName:"checking",mdxType:"ProductConcept"})," if Anne, Beth, Charles, or Dianne have permission to view the live video or rename the device, will get you the correct answers back."),(0,i.kt)("p",null,"The resulting authorization model is:"),(0,i.kt)(r.lG,{configuration:{schema_version:"1.1",type_definitions:[{type:"device",relations:{it_admin:{this:{}},security_guard:{this:{}},live_video_viewer:{union:{child:[{this:{}},{computedUserset:{relation:"it_admin"}},{computedUserset:{relation:"security_guard"}}]}},recorded_video_viewer:{union:{child:[{this:{}},{computedUserset:{relation:"it_admin"}},{computedUserset:{relation:"security_guard"}}]}},device_renamer:{union:{child:[{this:{}},{computedUserset:{relation:"it_admin"}}]}}},metadata:{relations:{it_admin:{directly_related_user_types:[{type:"user"}]},security_guard:{directly_related_user_types:[{type:"user"}]},live_video_viewer:{directly_related_user_types:[{type:"user"}]},recorded_video_viewer:{directly_related_user_types:[{type:"user"}]},device_renamer:{directly_related_user_types:[{type:"user"}]}}}}]},mdxType:"AuthzModelSnippetViewer"}),(0,i.kt)("p",null,"The requirements are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Anne")," and ",(0,i.kt)("strong",{parentName:"li"},"Charles")," are ",(0,i.kt)("strong",{parentName:"li"},"Security Guards")," with access ",(0,i.kt)("strong",{parentName:"li"},"Device 1")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Beth")," and ",(0,i.kt)("strong",{parentName:"li"},"Dianne")," are ",(0,i.kt)("strong",{parentName:"li"},"IT Admins")," with access ",(0,i.kt)("strong",{parentName:"li"},"Device 1")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Security Guards")," can ",(0,i.kt)("strong",{parentName:"li"},"view live and recorded video")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"IT Admins")," can ",(0,i.kt)("strong",{parentName:"li"},"view live and recorded video")," and ",(0,i.kt)("strong",{parentName:"li"},"rename")," devices")),(0,i.kt)("p",null,"Instead of adding different relationship tuples with direct relations to the actions they can take, as you did in the previous section, you will only add the relation to their role: ",(0,i.kt)("inlineCode",{parentName:"p"},"it_admin")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"security_guard"),"."),(0,i.kt)(r.Gb,{relationshipTuples:[{user:"user:anne",relation:"security_guard",object:"device:1"},{user:"user:beth",relation:"it_admin",object:"device:1"},{user:"user:charles",relation:"security_guard",object:"device:1"},{user:"user:dianne",relation:"it_admin",object:"device:1"}],mdxType:"WriteRequestViewer"}),(0,i.kt)("h4",{id:"verification-1"},"Verification"),(0,i.kt)("p",null,"We can now verify whether charles is related to device:1 as live_video_viewer."),(0,i.kt)(r.uT,{user:"user:charles",relation:"live_video_viewer",object:"device:1",allowed:!0,mdxType:"CheckRequestViewer"}),(0,i.kt)("p",null,"Check the other relationships for anne, beth, charles and dianne."),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"User"),(0,i.kt)("th",{parentName:"tr",align:null},"Object"),(0,i.kt)("th",{parentName:"tr",align:null},"Relation"),(0,i.kt)("th",{parentName:"tr",align:null},"Query"),(0,i.kt)("th",{parentName:"tr",align:null},"Relation?"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"anne")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:1")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"live_video_viewer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is anne related to device:1 as live_video_viewer?")),(0,i.kt)("td",{parentName:"tr",align:null},"Yes")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"beth")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:1")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"live_video_viewer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is beth related to device:1 as live_video_viewer?")),(0,i.kt)("td",{parentName:"tr",align:null},"Yes")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"anne")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:1")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"recorded_video_viewer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is anne related to device:1 as recorded_video_viewer?")),(0,i.kt)("td",{parentName:"tr",align:null},"Yes")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"beth")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:1")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"recorded_video_viewer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is beth related to device:1 as recorded_video_viewer?")),(0,i.kt)("td",{parentName:"tr",align:null},"Yes")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"anne")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:1")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device_renamer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is anne related to device:1 as device_renamer?")),(0,i.kt)("td",{parentName:"tr",align:null},"No")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"beth")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:1")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device_renamer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is beth related to device:1 as device_renamer?")),(0,i.kt)("td",{parentName:"tr",align:null},"Yes")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"charles")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:1")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"live_video_viewer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is charles related to device:1 as live_video_viewer?")),(0,i.kt)("td",{parentName:"tr",align:null},"Yes")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"dianne")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:1")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"live_video_viewer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is dianne related to device:1 as live_video_viewer?")),(0,i.kt)("td",{parentName:"tr",align:null},"Yes")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"charles")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:1")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"recorded_video_viewer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is charles related to device:1 as recorded_video_viewer?")),(0,i.kt)("td",{parentName:"tr",align:null},"Yes")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"dianne")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:1")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"recorded_video_viewer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is dianne related to device:1 as recorded_video_viewer?")),(0,i.kt)("td",{parentName:"tr",align:null},"Yes")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"charles")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:1")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device_renamer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is charles related to device:1 as device_renamer?")),(0,i.kt)("td",{parentName:"tr",align:null},"No")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"dianne")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:1")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device_renamer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is dianne related to device:1 as device_renamer?")),(0,i.kt)("td",{parentName:"tr",align:null},"Yes")))),(0,i.kt)("h3",{id:"04-modeling-device-groups"},"04. Modeling Device Groups"),(0,i.kt)("p",null,"Now that you are done with devices. Let us tackle device groups."),(0,i.kt)("p",null,"The requirements regarding device groups were:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Devices")," can be grouped into ",(0,i.kt)("strong",{parentName:"li"},"Device Groups")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Security guards")," with access to the ",(0,i.kt)("strong",{parentName:"li"},"Device Group")," are ",(0,i.kt)("strong",{parentName:"li"},"Security Guards")," with access to the ",(0,i.kt)("strong",{parentName:"li"},"Devices")," within the ",(0,i.kt)("strong",{parentName:"li"},"Device Group"),". Similarly for ",(0,i.kt)("strong",{parentName:"li"},"IT Admins"))),(0,i.kt)("p",null,"The ",(0,i.kt)(r.uH,{section:"what-is-a-type-definition",linkName:"type definition",mdxType:"ProductConcept"})," for the device group:"),(0,i.kt)(r.lG,{configuration:{type:"device_group",relations:{it_admin:{this:{}},security_guard:{this:{}}},metadata:{relations:{it_admin:{directly_related_user_types:[{type:"user"}]},security_guard:{directly_related_user_types:[{type:"user"}]}}}},mdxType:"AuthzModelSnippetViewer"}),(0,i.kt)("p",null,"With this change, the full ",(0,i.kt)(r.uH,{section:"what-is-an-authorization-model",linkName:"authorization model",mdxType:"ProductConcept"})," becomes:"),(0,i.kt)(r.lG,{configuration:{schema_version:"1.1",type_definitions:[{type:"user"},{type:"device",relations:{it_admin:{this:{}},security_guard:{this:{}},live_video_viewer:{union:{child:[{this:{}},{computedUserset:{relation:"it_admin"}},{computedUserset:{relation:"security_guard"}}]}},recorded_video_viewer:{union:{child:[{this:{}},{computedUserset:{relation:"it_admin"}},{computedUserset:{relation:"security_guard"}}]}},device_renamer:{union:{child:[{this:{}},{computedUserset:{relation:"it_admin"}}]}}},metadata:{relations:{it_admin:{directly_related_user_types:[{type:"user"},{type:"device_group",relation:"it_admin"}]},security_guard:{directly_related_user_types:[{type:"user"},{type:"device_group",relation:"security_guard"}]},live_video_viewer:{directly_related_user_types:[{type:"user"}]},recorded_video_viewer:{directly_related_user_types:[{type:"user"}]},device_renamer:{directly_related_user_types:[{type:"user"}]}}}},{type:"device_group",relations:{it_admin:{this:{}},security_guard:{this:{}}},metadata:{relations:{it_admin:{directly_related_user_types:[{type:"user"}]},security_guard:{directly_related_user_types:[{type:"user"}]}}}}]},mdxType:"AuthzModelSnippetViewer"}),(0,i.kt)("h4",{id:"updating-relationship-tuples-on-roles"},"Updating Relationship Tuples On Roles"),(0,i.kt)("p",null,"Remember that ",(0,i.kt)("strong",{parentName:"p"},"Charles")," is a ",(0,i.kt)("strong",{parentName:"p"},"Security Guard"),", and ",(0,i.kt)("strong",{parentName:"p"},"Dianne")," an ",(0,i.kt)("strong",{parentName:"p"},"IT Admin")," on ",(0,i.kt)("strong",{parentName:"p"},"Group 1"),", enter the ",(0,i.kt)(r.uH,{section:"what-is-a-relationship-tuple",linkName:"relationship tuples",mdxType:"ProductConcept"})," below to reflect that."),(0,i.kt)(r.Gb,{relationshipTuples:[{user:"user:charles",relation:"security_guard",object:"device_group:group1"},{user:"user:dianne",relation:"it_admin",object:"device_group:group1"}],mdxType:"WriteRequestViewer"}),(0,i.kt)("p",null,"You still need to give all the security guards of group1 a ",(0,i.kt)("inlineCode",{parentName:"p"},"security_guard")," relation to devices 2 and 3, and similarly for IT Admins. Add the following relationship tuples to do that."),(0,i.kt)(r.Gb,{relationshipTuples:[{user:"device_group:group1#security_guard",relation:"security_guard",object:"device:2"},{user:"device_group:group1#security_guard",relation:"security_guard",object:"device:3"},{user:"device_group:group1#it_admin",relation:"it_admin",object:"device:2"},{user:"device_group:group1#it_admin",relation:"it_admin",object:"device:3"}],mdxType:"WriteRequestViewer"}),(0,i.kt)("h4",{id:"verification-2"},"Verification"),(0,i.kt)("p",null,"Now that you have finalized the model and added the relationship tuples, you can start asking some queries. Try asking the same queries you did earlier but on device 2 instead of device 1."),(0,i.kt)("p",null,"We can ask ",(0,i.kt)("inlineCode",{parentName:"p"},"is dianne related to device:2 as live_video_viewer?")),(0,i.kt)(r.uT,{user:"dianne",relation:"live_video_viewer",object:"device:2",allowed:!0,mdxType:"CheckRequestViewer"}),(0,i.kt)("p",null,"Type any of the following queries in the ",(0,i.kt)("strong",{parentName:"p"},"TUPLE QUERIES")," section and press ",(0,i.kt)("strong",{parentName:"p"},"ENTER")," on your keyboard to see the results."),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"User"),(0,i.kt)("th",{parentName:"tr",align:null},"Object"),(0,i.kt)("th",{parentName:"tr",align:null},"Relation"),(0,i.kt)("th",{parentName:"tr",align:null},"Query"),(0,i.kt)("th",{parentName:"tr",align:null},"Relation?"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"anne")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:2")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"live_video_viewer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is anne related to device:2 as live_video_viewer?")),(0,i.kt)("td",{parentName:"tr",align:null},"No")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"beth")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:2")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"live_video_viewer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is beth related to device:2 as live_video_viewer?")),(0,i.kt)("td",{parentName:"tr",align:null},"No")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"anne")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:2")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"recorded_video_viewer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is anne related to device:2 as recorded_video_viewer?")),(0,i.kt)("td",{parentName:"tr",align:null},"No")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"beth")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:2")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"recorded_video_viewer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is beth related to device:2 as recorded_video_viewer?")),(0,i.kt)("td",{parentName:"tr",align:null},"No")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"anne")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:2")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device_renamer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is anne related to device:2 as device_renamer?")),(0,i.kt)("td",{parentName:"tr",align:null},"No")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"beth")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:2")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device_renamer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is beth related to device:2 as device_renamer?")),(0,i.kt)("td",{parentName:"tr",align:null},"No")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"charles")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:2")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"live_video_viewer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is charles related to device:2 as live_video_viewer?")),(0,i.kt)("td",{parentName:"tr",align:null},"Yes")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"dianne")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:2")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"live_video_viewer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is dianne related to device:2 as live_video_viewer?")),(0,i.kt)("td",{parentName:"tr",align:null},"Yes")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"charles")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:2")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"recorded_video_viewer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is charles related to device:2 as recorded_video_viewer?")),(0,i.kt)("td",{parentName:"tr",align:null},"Yes")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"dianne")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:2")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"recorded_video_viewer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is dianne related to device:2 as recorded_video_viewer?")),(0,i.kt)("td",{parentName:"tr",align:null},"Yes")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"charles")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:2")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device_renamer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is charles related to device:2 as device_renamer?")),(0,i.kt)("td",{parentName:"tr",align:null},"No")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"dianne")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:2")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device_renamer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is dianne related to device:2 as device_renamer?")),(0,i.kt)("td",{parentName:"tr",align:null},"Yes")))),(0,i.kt)("h3",{id:"05-disallow-direct-relationships-to-users"},"05. Disallow Direct Relationships To Users"),(0,i.kt)("p",null,"Notice that despite following ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("a",{parentName:"strong",href:"/docs/modeling/advanced/iot#03-updating-our-authorization-model-to-facilitate-future-changes"},"Step 03")),", anne and beth still have direct relations to all the actions they can take on device:1."),(0,i.kt)("h4",{id:"updating-the-authorization-model"},"Updating The Authorization Model"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"anne")," is a ",(0,i.kt)("inlineCode",{parentName:"p"},"live_video_viewer")," by both her position as ",(0,i.kt)("inlineCode",{parentName:"p"},"security_guard")," as well as her ",(0,i.kt)("em",{parentName:"p"},(0,i.kt)(r.uH,{section:"what-are-direct-and-implied-relationships",linkName:"direct relationship",mdxType:"ProductConcept"}))," assignment. This is undesirable. Imagine ",(0,i.kt)("inlineCode",{parentName:"p"},"anne")," left her position of ",(0,i.kt)("inlineCode",{parentName:"p"},"security_guard")," and she will still have ",(0,i.kt)("inlineCode",{parentName:"p"},"live_video_viewer")," access to ",(0,i.kt)("inlineCode",{parentName:"p"},"device:1"),"."),(0,i.kt)("p",null,"To remedy this, remove ",(0,i.kt)("inlineCode",{parentName:"p"},"self")," from ",(0,i.kt)("inlineCode",{parentName:"p"},"live_video_viewer"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"recorded_video_viewer")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"device_renamer"),". This denies direct relations to ",(0,i.kt)("inlineCode",{parentName:"p"},"live_video_viewer"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"recorded_video_viewer")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"device_renamer")," from having an effect. To do this:"),(0,i.kt)(r.lG,{configuration:{schema_version:"1.1",type_definitions:[{type:"user"},{type:"device",relations:{it_admin:{this:{}},security_guard:{this:{}},live_video_viewer:{union:{child:[{computedUserset:{relation:"it_admin"}},{computedUserset:{relation:"security_guard"}}]}},recorded_video_viewer:{union:{child:[{computedUserset:{relation:"it_admin"}},{computedUserset:{relation:"security_guard"}}]}},device_renamer:{union:{child:[{computedUserset:{relation:"it_admin"}}]}}},metadata:{relations:{it_admin:{directly_related_user_types:[{type:"user"},{type:"device_group",relation:"it_admin"}]},security_guard:{directly_related_user_types:[{type:"user"},{type:"device_group",relation:"security_guard"}]}}}},{type:"device_group",relations:{it_admin:{this:{}},security_guard:{this:{}}},metadata:{relations:{it_admin:{directly_related_user_types:[{type:"user"}]},security_guard:{directly_related_user_types:[{type:"user"}]}}}}]},mdxType:"AuthzModelSnippetViewer"}),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"Notice that any reference to the ",(0,i.kt)("a",{parentName:"p",href:"/docs/configuration-language#the-direct-relationship-keyword"},(0,i.kt)("strong",{parentName:"a"},"direct relationship keyword"))," (",(0,i.kt)("inlineCode",{parentName:"p"},"self")," in the friendly Syntax - or ",(0,i.kt)("inlineCode",{parentName:"p"},"this")," in the api syntax) has been removed. That indicates that a user cannot have a ",(0,i.kt)(r.uH,{section:"what-are-direct-and-implied-relationships",linkName:"direct relationship",mdxType:"ProductConcept"})," with an object in this type."),(0,i.kt)("p",{parentName:"admonition"},"With this change, ",(0,i.kt)("inlineCode",{parentName:"p"},"anne")," can no longer have a ",(0,i.kt)("inlineCode",{parentName:"p"},"live_video_viewer")," permission for ",(0,i.kt)("inlineCode",{parentName:"p"},"device:1")," except through having a ",(0,i.kt)("inlineCode",{parentName:"p"},"security_guard")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"it_admin")," role first, and when she loses access to that role, she will automatically lose access to the ",(0,i.kt)("inlineCode",{parentName:"p"},"live_video_viewer")," permission.")),(0,i.kt)("h4",{id:"verification-3"},"Verification"),(0,i.kt)("p",null,"Now that direct relationship is denied, we should see that ",(0,i.kt)("inlineCode",{parentName:"p"},"anne")," has ",(0,i.kt)("inlineCode",{parentName:"p"},"live_video_viewer")," relation to ",(0,i.kt)("inlineCode",{parentName:"p"},"device:1")," solely based on her position as ",(0,i.kt)("inlineCode",{parentName:"p"},"security_guard")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"device:1"),". Let's find out."),(0,i.kt)("p",null,"To test this, we can add a new user ",(0,i.kt)("inlineCode",{parentName:"p"},"emily"),". Emily is ",(0,i.kt)("strong",{parentName:"p"},"not")," a ",(0,i.kt)("inlineCode",{parentName:"p"},"security_guard")," nor an ",(0,i.kt)("inlineCode",{parentName:"p"},"it_admin"),". However, we attempt to access via direct relations by adding the following ",(0,i.kt)(r.uH,{section:"what-is-a-relationship-tuple",linkName:"relationship tuples",mdxType:"ProductConcept"}),":"),(0,i.kt)(r.Gb,{relationshipTuples:[{user:"user:emily",relation:"live_video_viewer",object:"device:1"},{user:"user:emily",relation:"recorded_video_viewer",object:"device:1"},{user:"user:emily",relation:"device_renamer",object:"device:1"}],mdxType:"WriteRequestViewer"}),(0,i.kt)("p",null,"Now try to query ",(0,i.kt)("inlineCode",{parentName:"p"},"is emily related to device:1 as live_video_viewer?"),". The returned result should be ",(0,i.kt)("inlineCode",{parentName:"p"},"emily is not related to device:1 as live_video_viewer"),". This confirms that direct relations have no effect on the ",(0,i.kt)("inlineCode",{parentName:"p"},"live_video_viewer")," relations, and that is because the ",(0,i.kt)("a",{parentName:"p",href:"/docs/configuration-language#the-direct-relationship-keyword"},(0,i.kt)("strong",{parentName:"a"},"direct relationship keyword"))," (",(0,i.kt)("inlineCode",{parentName:"p"},"self"),") was removed from the relation configuration."),(0,i.kt)(r.uT,{user:"user:emily",relation:"live_video_viewer",object:"device:1",allowed:!1,mdxType:"CheckRequestViewer"}),(0,i.kt)("p",null,"Query on the other relationships and you will see:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"User"),(0,i.kt)("th",{parentName:"tr",align:null},"Object"),(0,i.kt)("th",{parentName:"tr",align:null},"Relation"),(0,i.kt)("th",{parentName:"tr",align:null},"Query"),(0,i.kt)("th",{parentName:"tr",align:null},"Relation?"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"emily")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:1")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"recorded_video_viewer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is emily related to device:1 as recorded_video_viewer?")),(0,i.kt)("td",{parentName:"tr",align:null},"No")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"emily")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device:1")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"device_renamer")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"is emily related to device:1 as device_renamer?")),(0,i.kt)("td",{parentName:"tr",align:null},"No")))),(0,i.kt)("h2",{id:"summary"},"Summary"),(0,i.kt)("p",null,"In this post, you were introduced to ",(0,i.kt)(r.UV,{linkName:"fine grain authentication",section:"what-is-fine-grained-authorization-fga",mdxType:"IntroductionSection"})," and ",(0,i.kt)(r.rZ,{format:r.v7.LongForm,mdxType:"ProductName"}),"."),(0,i.kt)("p",null,"Upcoming posts will dive deeper into ",(0,i.kt)(r.rZ,{format:r.v7.LongForm,mdxType:"ProductName"}),", introducing concepts that will improve on the model you built today, and tackling more complex permission systems, with more relations and requirements that need to be met."),(0,i.kt)(r.XQ,{title:"IoT",preset:"iot",example:"IoT",store:"iot",mdxType:"Playground"}),(0,i.kt)("h3",{id:"exercises-for-you"},"Exercises For You"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Try adding a second group tied to devices 4 and 5. Add only Charles and Dianne to this group, then try to run queries that would validate your model."),(0,i.kt)("li",{parentName:"ul"},"Management has decided that Security Guards can only access live videos, and instituted a new position called Security Officer who can view both live and recorded videos. Can you update the authorization model to reflect that?")))}u.isMDXComponent=!0},74943:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/iot-01-01e62d5f3e91ef20a4f763fb2079c1fa.svg"}}]);