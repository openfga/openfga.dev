"use strict";(self.webpackChunkopenfga_dev=self.webpackChunkopenfga_dev||[]).push([[1817],{16820:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return p},default:function(){return m},frontMatter:function(){return r},metadata:function(){return d},toc:function(){return c}});var i=n(87462),a=n(63366),o=(n(67294),n(3905)),l=n(80566),s=["components"],r={sidebar_position:2,slug:"/writing-data/transactional-writes"},p="Transactional Writes",d={unversionedId:"content/writing-data/transactional-writes",id:"content/writing-data/transactional-writes",title:"Transactional Writes",description:"In this guide you will learn how to update multiple  in a single transaction.",source:"@site/docs/content/writing-data/transactional-writes.mdx",sourceDirName:"content/writing-data",slug:"/writing-data/transactional-writes",permalink:"/writing-data/transactional-writes",draft:!1,editUrl:"https://github.com/openfga/openfga.dev/edit/main/docs/content/writing-data/transactional-writes.mdx",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,slug:"/writing-data/transactional-writes"},sidebar:"docs",previous:{title:"Managing Relationships Between Objects",permalink:"/writing-data/managing-relationships-between-objects"},next:{title:"Comparison between Check, Read and Expand API Calls",permalink:"/writing-data/advanced/check-read-expand"}},u={},c=[{value:"Before you start",id:"before-you-start",level:2},{value:"Modeling Basics",id:"modeling-basics",level:3},{value:"Modeling Public Access",id:"modeling-public-access",level:3},{value:"<ProductName format={ProductNameFormat.ShortForm}/> Concepts",id:"-concepts",level:3},{value:"Step by Step",id:"step-by-step",level:2},{value:"01. Adding and removing relationship tuples in the same transaction",id:"01-adding-and-removing-relationship-tuples-in-the-same-transaction",level:3},{value:"02. Adding multiple related relationship tuples in the same transaction",id:"02-adding-multiple-related-relationship-tuples-in-the-same-transaction",level:3},{value:"Related Sections",id:"related-sections",level:2}],h={toc:c};function m(e){var t=e.components,n=(0,a.Z)(e,s);return(0,o.kt)("wrapper",(0,i.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"transactional-writes"},"Transactional Writes"),(0,o.kt)(l.AH,{mdxType:"DocumentationNotice"}),(0,o.kt)("p",null,"In this guide you will learn how to update multiple ",(0,o.kt)(l.uH,{section:"what-is-a-relationship-tuple",linkName:"relationship tuples",mdxType:"ProductConcept"})," in a single transaction."),(0,o.kt)(l.S1,{title:"When to use",appearance:"filled",description:(0,o.kt)("div",null,(0,o.kt)("p",null,"Updating multiple relationship tuples is useful to keep system state consistent.")),mdxType:"CardBox"}),(0,o.kt)("h2",{id:"before-you-start"},"Before you start"),(0,o.kt)("p",null,"In order to understand this guide correctly you must be familiar with some ",(0,o.kt)(l.uH,{mdxType:"ProductConcept"})," and know how to develop the things that we will list below."),(0,o.kt)("details",null,(0,o.kt)("summary",null,(0,o.kt)("p",null,"Assume that you have the following ",(0,o.kt)(l.uH,{section:"what-is-an-authorization-model",linkName:"authorization model",mdxType:"ProductConcept"}),".",(0,o.kt)("br",null),"\nYou have a ",(0,o.kt)(l.uH,{section:"what-is-a-type",linkName:"type",mdxType:"ProductConcept"})," called ",(0,o.kt)("inlineCode",{parentName:"p"},"tweet")," that can have a ",(0,o.kt)("inlineCode",{parentName:"p"},"reader"),".\nYou have another type called ",(0,o.kt)("inlineCode",{parentName:"p"},"user")," that can have a ",(0,o.kt)("inlineCode",{parentName:"p"},"follower")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"followed_by")," relationship.")),(0,o.kt)(l.lG,{configuration:{type_definitions:[{type:"tweet",relations:{reader:{this:{}}}},{type:"user",relations:{follower:{this:{}},followed_by:{this:{}}}}]},mdxType:"AuthzModelSnippetViewer"}),(0,o.kt)("hr",null),(0,o.kt)("p",null,"In addition, you will need to know the following:"),(0,o.kt)("h3",{id:"modeling-basics"},"Modeling Basics"),(0,o.kt)("p",null,"You need to know how to create an authorization model and create a relationship tuple to grant a user access to an object. ",(0,o.kt)("a",{parentName:"p",href:"/modeling/basics/modeling-basics"},"Learn more \u2192")),(0,o.kt)("h3",{id:"modeling-public-access"},"Modeling Public Access"),(0,o.kt)("p",null,"You need to know how to grant public access to an object. ",(0,o.kt)("a",{parentName:"p",href:"/modeling/basics/public-access"},"Learn more \u2192")),(0,o.kt)("h3",{id:"-concepts"},(0,o.kt)(l.rZ,{format:l.v7.ShortForm,mdxType:"ProductName"})," Concepts"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"A ",(0,o.kt)(l.uH,{section:"what-is-a-type",linkName:"Type",mdxType:"ProductConcept"}),": a class of objects that have similar characteristics"),(0,o.kt)("li",{parentName:"ul"},"A ",(0,o.kt)(l.uH,{section:"what-is-a-user",linkName:"User",mdxType:"ProductConcept"}),": an entity in the system that can be related to an object"),(0,o.kt)("li",{parentName:"ul"},"A ",(0,o.kt)(l.uH,{section:"what-is-a-relation",linkName:"Relation",mdxType:"ProductConcept"}),": is a string defined in the type definition of an authorization model that defines the possibility of a relationship between objects of this type and other users in the system"),(0,o.kt)("li",{parentName:"ul"},"An ",(0,o.kt)(l.uH,{section:"what-is-an-object",linkName:"Object",mdxType:"ProductConcept"}),": represents an entity in the system. Users' relationships to it can be define through relationship tuples and the authorization model"),(0,o.kt)("li",{parentName:"ul"},"A ",(0,o.kt)(l.uH,{section:"what-is-a-relationship-tuple",linkName:"Relationship Tuple",mdxType:"ProductConcept"}),": a grouping consisting of a user, a relation and an object stored in ",(0,o.kt)(l.rZ,{format:l.v7.ShortForm,mdxType:"ProductName"})))),(0,o.kt)("h2",{id:"step-by-step"},"Step by Step"),(0,o.kt)("h3",{id:"01-adding-and-removing-relationship-tuples-in-the-same-transaction"},"01. Adding and removing relationship tuples in the same transaction"),(0,o.kt)("p",null,"When you need to add or delete tuples in your store, you can do so by calling the Write API. For example, if you want to make ",(0,o.kt)("inlineCode",{parentName:"p"},"tweet:1")," public by making everyone a ",(0,o.kt)("inlineCode",{parentName:"p"},"viewer"),", you write one tuple:"),(0,o.kt)(l.Gb,{relationshipTuples:[{user:"*",relation:"viewer",object:"tweet:1"}],mdxType:"WriteRequestViewer"}),(0,o.kt)("p",null,"And if you want to convert this ",(0,o.kt)("inlineCode",{parentName:"p"},"tweet")," to private, you would need to delete that tuple:"),(0,o.kt)(l.Gb,{deleteRelationshipTuples:[{user:"*",relation:"viewer",object:"tweet:1"}],mdxType:"WriteRequestViewer"}),(0,o.kt)("p",null,"By removing the tuple, we made the tweet visible to no-one, which may not be what we want."),(0,o.kt)("p",null,"The Write API allows you to send up to 10 unique tuples in the request. (This limit applies to the sum of both writes and deletes in that request). This means we can submit one API call that converts the ",(0,o.kt)("inlineCode",{parentName:"p"},"tweet")," from public to visible to only the ",(0,o.kt)("inlineCode",{parentName:"p"},"user"),"'s followers."),(0,o.kt)(l.Gb,{relationshipTuples:[{_description:"Anne's followers can view tweet:1",user:"user:anne#follower",relation:"viewer",object:"tweet:1"}],deleteRelationshipTuples:[{_description:"tweet:1 is no longer viewable by everyone (*)",user:"*",relation:"viewer",object:"tweet:1"}],mdxType:"WriteRequestViewer"}),(0,o.kt)("h3",{id:"02-adding-multiple-related-relationship-tuples-in-the-same-transaction"},"02. Adding multiple related relationship tuples in the same transaction"),(0,o.kt)("p",null,"Having the ability to send multiple tuples per request is also useful when you want to maintain consistency. For example, if ",(0,o.kt)("inlineCode",{parentName:"p"},"anne")," starts following ",(0,o.kt)("inlineCode",{parentName:"p"},"becky"),", we want to be able to save the following two tuples, or neither of them:"),(0,o.kt)(l.Wz,{relationshipTuples:[{_description:"Anne is a follower of Becky",user:"anne",relation:"follower",object:"user:becky"},{_description:"Becky is followed by Anne",user:"becky",relation:"followed_by",object:"user:anne"}],mdxType:"RelationshipTuplesViewer"}),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"We have a type called user in this case because users can be related to each other, so the users now are a type in the system"))),(0,o.kt)("p",null,"The ",(0,o.kt)(l.rZ,{format:l.v7.LongForm,mdxType:"ProductName"})," service will attempt to perform all the changes sent in a single Write API call in one transaction. If it can't (for example, if any of the requested changes fails), it will reject all of the changes."),(0,o.kt)("h2",{id:"related-sections"},"Related Sections"),(0,o.kt)(l.$q,{description:"Check the following sections for more on how to update tuples.",relatedLinks:[{title:"Update relationship tuples in SDK",description:"Learn about how to update relationship tuples in SDK.",link:"/integration/update-tuples",id:"../integration/update-tuples"},{title:"{ProductName} API",description:"Details on the write API in the {ProductName} reference guide.",link:"/api/service#/Tuples/Write"}],mdxType:"RelatedSection"}))}m.isMDXComponent=!0}}]);