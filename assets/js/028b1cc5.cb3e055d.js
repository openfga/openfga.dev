"use strict";(self.webpackChunkopenfga_dev=self.webpackChunkopenfga_dev||[]).push([[5289],{20936:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>u,contentTitle:()=>d,default:()=>c,frontMatter:()=>s,metadata:()=>p,toc:()=>h});var n=a(87462),i=(a(67294),a(3905)),o=a(5270),l=a(65488),r=a(85162);const s={title:"How to get tuple changes",sidebar_position:1,slug:"/interacting/read-tuple-changes"},d="How to get tuple changes",p={unversionedId:"content/interacting/read-tuple-changes",id:"content/interacting/read-tuple-changes",title:"How to get tuple changes",description:"This section illustrates how to call the Read Changes API to get the list of relationship tuple changes that happened in your store, in the exact order that they happened. The API response includes tuples that have been added or removed in your store. It does not include other changes, like updates to your authorization model and adding new assertions.",source:"@site/docs/content/interacting/read-tuple-changes.mdx",sourceDirName:"content/interacting",slug:"/interacting/read-tuple-changes",permalink:"/docs/interacting/read-tuple-changes",draft:!1,editUrl:"https://github.com/openfga/openfga.dev/edit/main/docs/content/interacting/read-tuple-changes.mdx",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"How to get tuple changes",sidebar_position:1,slug:"/interacting/read-tuple-changes"},sidebar:"docs",previous:{title:"Relationship Queries: Check, Read, Expand, and ListObjects",permalink:"/docs/interacting/relationship-queries"},next:{title:"Search With Permissions",permalink:"/docs/interacting/search-with-permissions"}},u={},h=[{value:"Before you start",id:"before-you-start",level:2},{value:"Step By Step",id:"step-by-step",level:2},{value:"01. Configure The <ProductName format={ProductNameFormat.ShortForm}/> API Client",id:"01-configure-the--api-client",level:3},{value:"02. Get Changes For All Object Types",id:"02-get-changes-for-all-object-types",level:3},{value:"03. Get Changes For A Specific Object Type",id:"03-get-changes-for-a-specific-object-type",level:3}],m={toc:h};function c(e){let{components:t,...a}=e;return(0,i.kt)("wrapper",(0,n.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"how-to-get-tuple-changes"},"How to get tuple changes"),(0,i.kt)(o.AH,{mdxType:"DocumentationNotice"}),(0,i.kt)("p",null,"This section illustrates how to call the Read Changes API to get the list of relationship tuple changes that happened in your store, in the exact order that they happened. The API response includes tuples that have been added or removed in your store. It does not include other changes, like updates to your authorization model and adding new assertions."),(0,i.kt)("h2",{id:"before-you-start"},"Before you start"),(0,i.kt)(l.Z,{groupId:"languages",mdxType:"Tabs"},(0,i.kt)(r.Z,{value:o.eU.JS_SDK,label:o.UB.get(o.eU.JS_SDK),mdxType:"TabItem"},(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)(o.YY,{mdxType:"SdkSetupPrerequisite"})),(0,i.kt)("li",{parentName:"ol"},"You have ",(0,i.kt)("a",{parentName:"li",href:"/docs/getting-started/install-sdk"},"installed the SDK"),"."),(0,i.kt)("li",{parentName:"ol"},"You have ",(0,i.kt)("a",{parentName:"li",href:"../modeling"},"configured the ",(0,i.kt)("em",{parentName:"a"},"authorization model"))," and ",(0,i.kt)("a",{parentName:"li",href:"/docs/getting-started/update-tuples#02-calling-write-api-to-add-new-relationship-tuples"},"added some ",(0,i.kt)("em",{parentName:"a"},"relationship tuples")),"."),(0,i.kt)("li",{parentName:"ol"},"You have loaded ",(0,i.kt)("inlineCode",{parentName:"li"},"FGA_STORE_ID")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"FGA_API_HOST")," as environment variables."))),(0,i.kt)(r.Z,{value:o.eU.GO_SDK,label:o.UB.get(o.eU.GO_SDK),mdxType:"TabItem"},(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)(o.YY,{mdxType:"SdkSetupPrerequisite"})),(0,i.kt)("li",{parentName:"ol"},"You have ",(0,i.kt)("a",{parentName:"li",href:"/docs/getting-started/install-sdk"},"installed the SDK"),"."),(0,i.kt)("li",{parentName:"ol"},"You have ",(0,i.kt)("a",{parentName:"li",href:"../modeling"},"configured the ",(0,i.kt)("em",{parentName:"a"},"authorization model"))," and ",(0,i.kt)("a",{parentName:"li",href:"/docs/getting-started/update-tuples#02-calling-write-api-to-add-new-relationship-tuples"},"added some ",(0,i.kt)("em",{parentName:"a"},"relationship tuples")),"."),(0,i.kt)("li",{parentName:"ol"},"You have loaded ",(0,i.kt)("inlineCode",{parentName:"li"},"FGA_STORE_ID")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"FGA_API_HOST")," as environment variables."))),(0,i.kt)(r.Z,{value:o.eU.DOTNET_SDK,label:o.UB.get(o.eU.DOTNET_SDK),mdxType:"TabItem"},(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)(o.YY,{mdxType:"SdkSetupPrerequisite"})),(0,i.kt)("li",{parentName:"ol"},"You have ",(0,i.kt)("a",{parentName:"li",href:"/docs/getting-started/install-sdk"},"installed the SDK"),"."),(0,i.kt)("li",{parentName:"ol"},"You have ",(0,i.kt)("a",{parentName:"li",href:"../modeling"},"configured the ",(0,i.kt)("em",{parentName:"a"},"authorization model")),"."),(0,i.kt)("li",{parentName:"ol"},"You have loaded ",(0,i.kt)("inlineCode",{parentName:"li"},"FGA_STORE_ID")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"FGA_API_HOST")," as environment variables."))),(0,i.kt)(r.Z,{value:o.eU.PYTHON_SDK,label:o.UB.get(o.eU.PYTHON_SDK),mdxType:"TabItem"},(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)(o.YY,{mdxType:"SdkSetupPrerequisite"})),(0,i.kt)("li",{parentName:"ol"},"You have ",(0,i.kt)("a",{parentName:"li",href:"/docs/getting-started/install-sdk"},"installed the SDK"),"."),(0,i.kt)("li",{parentName:"ol"},"You have ",(0,i.kt)("a",{parentName:"li",href:"../modeling"},"configured the ",(0,i.kt)("em",{parentName:"a"},"authorization model")),"."),(0,i.kt)("li",{parentName:"ol"},"You have loaded ",(0,i.kt)("inlineCode",{parentName:"li"},"FGA_STORE_ID")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"FGA_API_HOST")," as environment variables."))),(0,i.kt)(r.Z,{value:o.eU.CURL,label:o.UB.get(o.eU.CURL),mdxType:"TabItem"},(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)(o.YY,{mdxType:"SdkSetupPrerequisite"})),(0,i.kt)("li",{parentName:"ol"},"You have ",(0,i.kt)("a",{parentName:"li",href:"../modeling"},"configured the ",(0,i.kt)("em",{parentName:"a"},"authorization model"))," and ",(0,i.kt)("a",{parentName:"li",href:"/docs/getting-started/update-tuples#02-calling-write-api-to-add-new-relationship-tuples"},"added some ",(0,i.kt)("em",{parentName:"a"},"relationship tuples")),"."),(0,i.kt)("li",{parentName:"ol"},"You have loaded ",(0,i.kt)("inlineCode",{parentName:"li"},"FGA_STORE_ID")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"FGA_API_HOST")," as environment variables.")))),(0,i.kt)("h2",{id:"step-by-step"},"Step By Step"),(0,i.kt)("p",null,"To get a chronologically ordered list of tuples that have been written or deleted in your store, you can do so by calling the Read Changes API."),(0,i.kt)("h3",{id:"01-configure-the--api-client"},"01. Configure The ",(0,i.kt)(o.rZ,{format:o.v7.ShortForm,mdxType:"ProductName"})," API Client"),(0,i.kt)("p",null,"First you will need to configure the API client."),(0,i.kt)(l.Z,{groupId:"languages",mdxType:"Tabs"},(0,i.kt)(r.Z,{value:o.eU.JS_SDK,label:o.UB.get(o.eU.JS_SDK),mdxType:"TabItem"},(0,i.kt)(o.j3,{lang:"js-sdk",mdxType:"SdkSetupHeader"})),(0,i.kt)(r.Z,{value:o.eU.GO_SDK,label:o.UB.get(o.eU.GO_SDK),mdxType:"TabItem"},(0,i.kt)(o.j3,{lang:"go-sdk",mdxType:"SdkSetupHeader"})),(0,i.kt)(r.Z,{value:o.eU.DOTNET_SDK,label:o.UB.get(o.eU.DOTNET_SDK),mdxType:"TabItem"},(0,i.kt)(o.j3,{lang:"dotnet-sdk",mdxType:"SdkSetupHeader"})),(0,i.kt)(r.Z,{value:o.eU.PYTHON_SDK,label:o.UB.get(o.eU.PYTHON_SDK),mdxType:"TabItem"},(0,i.kt)(o.j3,{lang:"python-sdk",mdxType:"SdkSetupHeader"})),(0,i.kt)(r.Z,{value:o.eU.CURL,label:o.UB.get(o.eU.CURL),mdxType:"TabItem"},(0,i.kt)("p",null,"To obtain the ",(0,i.kt)("a",{parentName:"p",href:"https://auth0.com/docs/authorization/flows/call-your-api-using-the-client-credentials-flow"},"access token"),":"),(0,i.kt)(o.j3,{lang:"curl",mdxType:"SdkSetupHeader"}))),(0,i.kt)("h3",{id:"02-get-changes-for-all-object-types"},"02. Get Changes For All Object Types"),(0,i.kt)("p",null,"To get a paginated list of changes that happened in your store:"),(0,i.kt)(o.J_,{pageSize:25,skipSetup:!0,allowedLanguages:[o.eU.JS_SDK,o.eU.GO_SDK,o.eU.DOTNET_SDK,o.eU.PYTHON_SDK,o.eU.CURL],mdxType:"ReadChangesRequestViewer"}),(0,i.kt)("p",null,"The result will contain an array of up to 25 tuples, with the operation (",(0,i.kt)("inlineCode",{parentName:"p"},"write")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"delete"),"), and the timestamp in which that operation took place. The result will also contain a continuation token. Save the continuation token in persistent storage between calls so that it is not lost and you do not have to restart from scratch on system restart or on error."),(0,i.kt)("p",null,"You can then use this token to get the next set of changes:"),(0,i.kt)(o.J_,{pageSize:25,continuationToken:"eyJwayI6IkxBVEVTVF9OU0NPTkZJR19hdXRoMHN0b3JlIiwic2siOiIxem1qbXF3MWZLZExTcUoyN01MdTdqTjh0cWgifQ==",skipSetup:!0,allowedLanguages:[o.eU.JS_SDK,o.eU.GO_SDK,o.eU.DOTNET_SDK,o.eU.PYTHON_SDK,o.eU.CURL],mdxType:"ReadChangesRequestViewer"}),(0,i.kt)("p",null,"Once there are no more changes to retrieve, the API will return the same token as the one you sent. Save the token in persistent storage to use at a later time."),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("ul",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ul"},"The default page size is 50. The maximum page size allowed is 100."),(0,i.kt)("li",{parentName:"ul"},"The API response will not return all the changes immediately. There will be a delay of one minute between the time that you add or delete a tuple and the time that you see it in the Read Changes API response."),(0,i.kt)("li",{parentName:"ul"},"The API response does not expand the tuples. If you wrote a tuple that includes a userset, like ",(0,i.kt)("inlineCode",{parentName:"li"},'{"user": "group:abc#member", "relation": "owner": "doc:budget"}'),", the Read Changes API will return that exact tuple."))),(0,i.kt)("h3",{id:"03-get-changes-for-a-specific-object-type"},"03. Get Changes For A Specific Object Type"),(0,i.kt)("p",null,"Imagine you have the following authorization model:"),(0,i.kt)(o.lG,{configuration:{schema_version:"1.1",type_definitions:[{type:"user"},{type:"group",relations:{member:{this:{}}},metadata:{relations:{member:{directly_related_user_types:[{type:"user"}]}}}},{type:"folder",relations:{owner:{this:{}}},metadata:{relations:{owner:{directly_related_user_types:[{type:"group",relation:"member"},{type:"user"}]}}}},{type:"doc",relations:{owner:{this:{}}},metadata:{relations:{owner:{directly_related_user_types:[{type:"group",relation:"member"},{type:"user"}]}}}}]},mdxType:"AuthzModelSnippetViewer"}),(0,i.kt)("p",null,"It is possible to get a list of changes that happened in your store that relate only to one specific object type, like ",(0,i.kt)("inlineCode",{parentName:"p"},"folder"),", by issuing a call like this:"),(0,i.kt)(o.J_,{pageSize:25,type:"folder",skipSetup:!0,allowedLanguages:[o.eU.JS_SDK,o.eU.GO_SDK,o.eU.DOTNET_SDK,o.eU.PYTHON_SDK,o.eU.CURL],mdxType:"ReadChangesRequestViewer"}),(0,i.kt)("p",null,"The response will include a continuation token. In subsequent calls, you have to include the token and the ",(0,i.kt)("inlineCode",{parentName:"p"},"type"),". (If you send this continuation token without the ",(0,i.kt)("inlineCode",{parentName:"p"},"type")," parameter set, you will get an error)."),(0,i.kt)(o.J_,{pageSize:25,type:"folder",continuationToken:"eyJwayI6IkxBVEVTVF9OU0NPTkZJR19hdXRoMHN0b3JlIiwic2siOiIxem1qbXF3MWZLZExTcUoyN01MdTdqTjh0cWgifQ==",skipSetup:!0,allowedLanguages:[o.eU.JS_SDK,o.eU.GO_SDK,o.eU.DOTNET_SDK,o.eU.PYTHON_SDK,o.eU.CURL],mdxType:"ReadChangesRequestViewer"}))}c.isMDXComponent=!0}}]);